<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Japanese Lessons</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .controls {
        margin-bottom: 30px;
        padding: 20px;
        background-color: #f5f5f5;
        border-radius: 8px;
      }
      .button-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }
      .nav-button {
        padding: 12px 16px;
        font-size: 16px;
        border: 2px solid #ddd;
        border-radius: 8px;
        background-color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .nav-button:hover {
        background-color: #f0f8ff;
        border-color: #2196f3;
        transform: translateY(-1px);
      }
      .nav-button.active {
        background-color: #2196f3;
        color: white;
        border-color: #1976d2;
      }
      .nav-button.disabled {
        background-color: #f5f5f5;
        color: #999;
        cursor: not-allowed;
        border-color: #e0e0e0;
      }
      .nav-button.disabled:hover {
        transform: none;
        background-color: #f5f5f5;
        border-color: #e0e0e0;
      }
      .section-title {
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 10px;
        color: #333;
      }
      .lesson-content {
        margin-top: 20px;
      }
      .phrase {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #fafafa;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 80%;
        max-width: 80%;
        margin-left: auto;
        margin-right: auto;
      }
      .phrase:hover {
        background-color: #f0f8ff;
        border-color: #2196f3;
      }
      .japanese {
        font-size: 3rem;
        font-weight: bold;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .hiragana {
        font-size: 1.5rem;
        color: #666;
        margin-bottom: 5px;
        opacity: 0;
        transition: opacity 0.3s ease 0.5s;
      }
      .romaji {
        font-size: 14px;
        color: #888;
        margin-bottom: 5px;
        opacity: 0;
        transition: opacity 0.3s ease 0.5s;
      }
      .translation {
        font-size: 32px;
        color: #333;
        font-style: italic;
        font-weight: bold;
      }
      .phrase:hover .japanese {
        opacity: 1;
        transition-delay: 0s;
      }
      .phrase:hover .hiragana {
        opacity: 1;
        transition-delay: 0.5s;
      }
      .phrase:hover .romaji {
        opacity: 1;
        transition-delay: 0.5s;
      }
      .phrase .japanese,
      .phrase .hiragana,
      .phrase .romaji {
        transition: opacity 0.2s ease;
      }
      .lesson-header {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .no-data {
        text-align: center;
        color: #888;
        font-style: italic;
        padding: 40px;
      }
    </style>
  </head>
  <body>
    <h1>Japanese Lessons</h1>

    <div class="controls">
      <div class="section-title">Select Module:</div>
      <div class="button-grid" id="moduleButtons">
        <!-- Module buttons will be populated here -->
      </div>

      <div class="section-title">Select Lesson:</div>
      <div class="button-grid" id="lessonButtons">
        <!-- Lesson buttons will be populated here -->
      </div>
    </div>

    <div class="lesson-content" id="lessonContent">
      <div class="no-data">Select a module and lesson to view content</div>
    </div>

    <script src="./parsed.js"></script>

    <script>
      let currentModule = null;
      let currentLesson = null;

      function loadData() {
        populateModules();
        // Initialize with Module 01, Lesson 1
        selectModule("01");
      }

      function populateModules() {
        const moduleButtons = document.getElementById("moduleButtons");
        moduleButtons.innerHTML = "";

        Object.keys(data).forEach((moduleKey) => {
          const button = document.createElement("button");
          button.className = "nav-button";
          button.textContent = `Module ${moduleKey}`;
          button.onclick = () => selectModule(moduleKey);
          button.dataset.module = moduleKey;
          moduleButtons.appendChild(button);
        });
      }

      function populateLessons(moduleKey) {
        const lessonButtons = document.getElementById("lessonButtons");
        lessonButtons.innerHTML = "";

        if (moduleKey && data[moduleKey]) {
          data[moduleKey].forEach((lesson, index) => {
            if (
              lesson.rows &&
              lesson.rows.some((row) => row.full && row.full.trim())
            ) {
              const button = document.createElement("button");
              button.className = "nav-button";
              button.textContent = `Lesson ${lesson.lesson}: ${lesson.title}`;
              button.onclick = () => selectLesson(index);
              button.dataset.lesson = index;
              lessonButtons.appendChild(button);
            }
          });
        }
      }

      function displayLesson(moduleKey, lessonIndex) {
        const contentDiv = document.getElementById("lessonContent");

        if (
          !moduleKey ||
          lessonIndex === "" ||
          !data[moduleKey] ||
          !data[moduleKey][lessonIndex]
        ) {
          contentDiv.innerHTML =
            '<div class="no-data">Select a module and lesson to view content</div>';
          return;
        }

        const lesson = data[moduleKey][lessonIndex];
        const validRows = lesson.rows.filter(
          (row) => row.full && row.full.trim()
        );

        if (validRows.length === 0) {
          contentDiv.innerHTML =
            '<div class="no-data">No content available for this lesson</div>';
          return;
        }

        let html = `
          <div class="lesson-header">
            <h2>Module ${lesson.module}, Lesson ${lesson.lesson}: ${lesson.title}</h2>
          </div>
        `;

        validRows.forEach((row) => {
          html += `
            <div class="phrase">
              <div class="japanese">${row.full}</div>
              ${
                row.hiragana
                  ? `<div class="hiragana">${row.hiragana}</div>`
                  : ""
              }
              ${row.romaji ? `<div class="romaji">${row.romaji}</div>` : ""}
              ${
                row.translation
                  ? `<div class="translation">${row.translation}</div>`
                  : ""
              }
            </div>
          `;
        });

        contentDiv.innerHTML = html;
      }

      function selectModule(moduleKey) {
        currentModule = moduleKey;
        currentLesson = null;

        // Update active states for module buttons
        document
          .querySelectorAll("#moduleButtons .nav-button")
          .forEach((btn) => {
            btn.classList.remove("active");
            if (btn.dataset.module === moduleKey) {
              btn.classList.add("active");
            }
          });

        // Clear lesson selection
        document
          .querySelectorAll("#lessonButtons .nav-button")
          .forEach((btn) => {
            btn.classList.remove("active");
          });

        populateLessons(moduleKey);

        // Auto-select first lesson if available
        if (moduleKey && data[moduleKey] && data[moduleKey].length > 0) {
          const firstValidLesson = data[moduleKey].findIndex(
            (lesson) =>
              lesson.rows &&
              lesson.rows.some((row) => row.full && row.full.trim())
          );
          if (firstValidLesson !== -1) {
            selectLesson(firstValidLesson);
          }
        } else {
          displayLesson(moduleKey, "");
        }
      }

      function selectLesson(lessonIndex) {
        currentLesson = lessonIndex;

        // Update active states for lesson buttons
        document
          .querySelectorAll("#lessonButtons .nav-button")
          .forEach((btn) => {
            btn.classList.remove("active");
            if (btn.dataset.lesson == lessonIndex) {
              btn.classList.add("active");
            }
          });

        displayLesson(currentModule, lessonIndex);
      }

      loadData();
    </script>
  </body>
</html>
